<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>model &mdash; GEB 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> GEB
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocessing/preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running.html">Running the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HRUs.html">Farm-level HRUs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Agents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../agents/__init__.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/farmers.html">Farmers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/ngo.html">NGO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/government.html">Government</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cwatm_model.html">CWatM Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report.html">Report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../artists.html">Artists</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../authors_page.html">Authors</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GEB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for model</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">honeybees.library.helpers</span> <span class="kn">import</span> <span class="n">timeprint</span>
<span class="kn">from</span> <span class="nn">honeybees.area</span> <span class="kn">import</span> <span class="n">Area</span>
<span class="kn">from</span> <span class="nn">reporter</span> <span class="kn">import</span> <span class="n">Reporter</span>
<span class="kn">from</span> <span class="nn">honeybees.model</span> <span class="kn">import</span> <span class="n">Model</span> <span class="k">as</span> <span class="n">ABM_Model</span>
<span class="kn">from</span> <span class="nn">agents</span> <span class="kn">import</span> <span class="n">Agents</span>
<span class="kn">from</span> <span class="nn">artists</span> <span class="kn">import</span> <span class="n">Artists</span>
<span class="kn">from</span> <span class="nn">HRUs</span> <span class="kn">import</span> <span class="n">Data</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">cwatm_model</span> <span class="kn">import</span> <span class="n">CWatM_Model</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="GEBModel"><a class="viewcode-back" href="../model.html#model.GEBModel">[docs]</a><span class="k">class</span> <span class="nc">GEBModel</span><span class="p">(</span><span class="n">ABM_Model</span><span class="p">,</span> <span class="n">CWatM_Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;GEB parent class.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        GEB_config_path: Filepath of the YAML-configuration file.</span>
<span class="sd">        CwatM_settings: Path of CWatM settings file.</span>
<span class="sd">        name: Name of model.</span>
<span class="sd">        xmin: Minimum x coordinate.</span>
<span class="sd">        xmax: Maximum x coordinate.</span>
<span class="sd">        ymin: Minimum y coordinate.</span>
<span class="sd">        ymax: Maximum y coordinate.</span>
<span class="sd">        args: Run arguments.</span>
<span class="sd">        coordinate_system: Coordinate system that should be used. Currently only accepts WGS84.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;GEB stands for Geographic Environmental and Behavioural model and is named after Geb, the personification of Earth in Egyptian mythology.</span><span class="se">\n</span><span class="s2">GEB aims to simulate both environment, for now the hydrological system, the behaviour of people and their interactions at large scale without sacrificing too much detail. The model does so by coupling an agent-based model which simulates millions individual people or households and a hydrological model. While the model can be expanded to other agents and environmental interactions, we focus on farmers, high-level agents, irrigation behaviour and land management for now.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GEB_config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
            <span class="n">cp</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">gpu_device</span><span class="p">)</span><span class="o">.</span><span class="n">use</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_config</span><span class="p">(</span><span class="n">GEB_config_path</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">][</span><span class="s1">&#39;initial_conditions_folder&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_ABM__</span><span class="p">(</span><span class="n">GEB_config_path</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_hydromodel__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">][</span><span class="s1">&#39;CWatM_settings&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span> <span class="o">=</span> <span class="n">Reporter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">areamaps_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">abm_reporter</span><span class="o">.</span><span class="n">export_folder</span><span class="p">,</span> <span class="s1">&#39;areamaps&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">areamaps_folder</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">areamaps_folder</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">areamaps_folder</span><span class="p">,</span> <span class="s1">&#39;land_owners.npy&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">HRU</span><span class="o">.</span><span class="n">land_owners</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">areamaps_folder</span><span class="p">,</span> <span class="s1">&#39;unmerged_HRU_indices.npy&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">HRU</span><span class="o">.</span><span class="n">unmerged_HRU_indices</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">areamaps_folder</span><span class="p">,</span> <span class="s1">&#39;scaling.npy&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">HRU</span><span class="o">.</span><span class="n">scaling</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init_ABM__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initializes the agent-based model.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            config_path: Filepath of the YAML-configuration file.</span>
<span class="sd">            study_area: Dictionary with study area name, xmin, xmax, ymin and ymax.</span>
<span class="sd">            args: Run arguments.</span>
<span class="sd">            coordinate_system: Coordinate system that should be used. Currently only accepts WGS84.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="n">timestep_length</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">scenario</span> <span class="o">==</span> <span class="s1">&#39;spinup&#39;</span><span class="p">:</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">][</span><span class="s1">&#39;spinup_start&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">][</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;general&#39;</span><span class="p">][</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_time</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_time</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        
        <span class="n">n_timesteps</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">current_time</span><span class="p">)</span> <span class="o">/</span> <span class="n">timestep_length</span>
        <span class="k">assert</span> <span class="n">n_timesteps</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span>
        <span class="n">n_timesteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_timesteps</span><span class="p">)</span>

        <span class="n">ABM_Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_time</span><span class="p">,</span> <span class="n">timestep_length</span><span class="p">,</span> <span class="n">config_path</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">n_timesteps</span><span class="o">=</span><span class="n">n_timesteps</span><span class="p">)</span>
        
        <span class="n">study_area</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;xmin&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
            <span class="s1">&#39;xmax&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
            <span class="s1">&#39;ymin&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
            <span class="s1">&#39;ymax&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">Area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">study_area</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agents</span> <span class="o">=</span> <span class="n">Agents</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">artists</span> <span class="o">=</span> <span class="n">Artists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">coordinate_system</span> <span class="o">==</span> <span class="s1">&#39;WGS84&#39;</span>  <span class="c1"># coordinate system must be WGS84. If not, all code needs to be reviewed</span>

        <span class="c1"># This variable is required for the batch runner. To stop the model</span>
        <span class="c1"># if some condition is met set running to False.</span>
        <span class="n">timeprint</span><span class="p">(</span><span class="s2">&quot;Finished setup&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init_hydromodel__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Function to initialize CWatM.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            settings: Filepath of CWatM settingsfile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CWatM_Model</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_timesteps</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

<div class="viewcode-block" id="GEBModel.step"><a class="viewcode-back" href="../model.html#model.GEBModel.step">[docs]</a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forward the model by the given the number of steps.</span>

<span class="sd">        Args:</span>
<span class="sd">            step_size: Number of steps the model should take. Can be integer or string `day`, `week`, `month`, `year`, `decade` or `century`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_step_str</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">step_size</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_time</span><span class="p">)</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">ABM_Model</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">CWatM_Model</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">,</span> <span class="s1">&#39;seconds&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GEBModel.run"><a class="viewcode-back" href="../model.html#model.GEBModel.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run the model for the entire period, and export water table in case of spinup scenario.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_timesteps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_initial</span><span class="p">:</span>
            
            <span class="n">initCondVar</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HRU.w1&#39;</span><span class="p">,</span> <span class="s1">&#39;HRU.w2&#39;</span><span class="p">,</span> <span class="s1">&#39;HRU.w3&#39;</span><span class="p">,</span> <span class="s1">&#39;HRU.topwater&#39;</span><span class="p">,</span> <span class="s1">&#39;HRU.interceptStor&#39;</span><span class="p">,</span> <span class="s1">&#39;HRU.SnowCoverS&#39;</span><span class="p">,</span> <span class="s1">&#39;HRU.FrostIndex&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.channelStorageM3&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.discharge&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.lakeInflow&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.lakeStorage&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.reservoirStorage&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.lakeVolume&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.outLake&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.lakeOutflow&#39;</span><span class="p">,</span> <span class="s1">&#39;modflow.head&#39;</span><span class="p">]</span>
            <span class="c1"># self.initCondVar.extend([&#39;grid.smalllakeInflow&#39;, &#39;grid.smalllakeStorage&#39;, &#39;grid.smalllakeOutflow&#39;, &#39;grid.smalllakeInflowOld&#39;, &#39;grid.smalllakeVolumeM3&#39;])</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions_folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions_folder</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">initvar</span> <span class="ow">in</span> <span class="n">initCondVar</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_conditions_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">initvar</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="n">initvar</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></div></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../copyright.html">Copyright</a> 2022, IIASA and VU-IVM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>